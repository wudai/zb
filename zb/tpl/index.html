<{include file="section/header.html"}>
<{cssholder}>
/bootstrap/datepicker/css/datepicker.css
<{/cssholder}>
<{jsholder}>
/bootstrap/datepicker/js/bootstrap-datepicker.js
<{/jsholder}>
<div class="container row-fluid">
	<div class="span7 offset1 form_input">
		<ul class="inline">
			<li>记录消费</li>
			<li><a href="/index.php?app=bill&act=income">记录收入</a></li>
		</ul>
		<form action="/index.php?app=bill&act=expense" method="post" class="form-horizontal">
		<div class="control-group">
			<label class="control-label">时间</label>
			<div class="controls"><input type="text" name="bill_date" value="<{if $smarty.get.bill_date}><{$smarty.get.bill_date}><{else}><{$smarty.now|date_format:"%Y-%m-%d"}><{/if}>" /></div>
		</div>
		<div class="control-group">
			<label class="control-label">地点</label>
			<div class="controls"><input type="text" name="position_name" autocomplete="off" /></div>
			<input type="hidden" name="position_id" />
		</div>
		<div class="control-group">
			<label class="control-label">金额</label>
			<div class="controls"><input type="text" name="amount" /></div>
		</div>
		<div class="control-group">
			<div class="controls">
				<a href="javascript:;">+添加消费明细</a>
			</div>
		</div>
		<div class="control-group">
			<div class="controls">
				<button type="submit" class="btn btn-primary" data-loading-text="保存中……">添加</button><button type="button" class="btn btn-link">取消</button>
			</div>
		</div>
		</form>
	</div>
	<div class="span3">
	</div>
	<div class="span7 offset1">
		<div class="container"><h3>最近消费</h3></div>
		<table class="table table-hover">
			<tbody>
				<{foreach $list as $line}>
				<tr>
					<td><{$line.event_date}></td>
					<td><{$line.position_name}></td>
					<td><{$line.amount|money}>元</td>
					<td><a href="javascript:;"><i class="icon-pencil"></i></a>&nbsp;<a href="javascript:;"><i class="icon-trash"></i></a></td>
				</tr>
				<{/foreach}>
			</tbody>
		</table>
	</div>
	<div class="span4">
	</div>
</div>
<{scriptholder}>
<script>
$(function() {
	$('input[name=bill_date]').datepicker({format: 'yyyy-mm-dd'});
	$('input[name=position_name]').typeahead({
		minChars:2,
		source: function(request,response){
			$('input[name=position_id]').val('');
			$.ajax({
				url: '/index.php?app=position&act=ajax_get',
				dataType: 'json',
				data:{
					q : request,
				},
				success:function(data){
					if(data.data) {
						var resultList = Array();
						resultList = data.data.map(function (item) {
							var aItem = { id: item.id, value: item.value};
							return JSON.stringify(aItem);
						});
						return response(resultList);
					}
				},
			});
		},
		matcher: function (obj) {
			return true;
		},
		sorter: function (items) {          
			var beginswith = [], caseSensitive = [], caseInsensitive = [], item;
			while (aItem = items.shift()) {
				var item = JSON.parse(aItem);
				if (!item.value.toLowerCase().indexOf(this.query.toLowerCase())) beginswith.push(JSON.stringify(item));
				else if (item.value.indexOf(this.query)) caseSensitive.push(JSON.stringify(item));
				else caseInsensitive.push(JSON.stringify(item));
			}
			return beginswith.concat(caseSensitive, caseInsensitive)
		},
		highlighter: function (obj) {
			var item = JSON.parse(obj);
			var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g, '\\$&')
			return item.value.replace(new RegExp('(' + query + ')', 'ig'), function ($1, match) {
				return '<strong>' + match + '</strong>'
			})
		},
		updater: function (obj) {
			var item = JSON.parse(obj);
			$('input[name="position_id"]').val(item.id);
			return item.value;
		}
	});
});
</script>
<{/scriptholder}>
<{include file="section/footer.html"}>
